<!--
 - Created by guan on 15/2/18.
 -->

<aura:component description="DiagramOutput">

    <aura:attribute name="allObjects" type="Object[]" />
    <aura:attribute name="selectedDiagram" type="Object" />
    <aura:attribute name="isExpanded" type="Boolean" default="false" />
    <aura:attribute name="graphvizContent" type="String" />
    <aura:attribute name="svgContent" type="String" />
    <aura:attribute name="obscuredEntities" type="List" default="[]"
                    description="Entities in the diagram which are not part of the SOQL query"/>

    <!--<aura:handler event="c:UserGuideEvent" action="{!c.handleUserGuideEvent}"/>-->
    <aura:registerEvent name="onTogglePreview" type="c:ActionEvent" />

    <aura:handler name="fromChange" event="c:SOQLFromChangeEvent" action="{!c.onFromChanged}"/>

    <aura:handler name="change" value="{!v.selectedDiagram}" action="{!c.onDiagramChanged}"/>

    <c:Panel>

        <aura:set attribute="icon">
            <aura:if isTrue="{!v.isExpanded}">
                <lightning:buttonIcon iconName="utility:contract" alternativeText="Contract" iconClass="slds-button_icon-x-small" onclick="{!c.onToggleState}" />
                <aura:set attribute="else">
                    <lightning:buttonIcon iconName="utility:expand" alternativeText="Expand" iconClass="slds-button_icon-x-small" onclick="{!c.onToggleState}" />
                </aura:set>
            </aura:if>
        </aura:set>

        <lightning:tabset>
            <lightning:tab>
                <aura:set attribute="label">
                    Preview
                </aura:set>
                <c:DiagramViewer aura:id="diagramViewer" graphvizContent="{!v.graphvizContent}" onDiagramRendered="{!c.onDiagramRendered}" />
                <c:SOQLRenderer aura:id="soql" diagram="{!v.selectedDiagram}"/>
            </lightning:tab>

            <lightning:tab>
                <aura:set attribute="label">
                    Download
                </aura:set>

                <lightning:textarea aura:id="graphvizContentText" name="graphvizContent" value="{!v.graphvizContent}" label="Graphviz" readonly="true" class="downloadTextArea" />
                <lightning:button label="Copy Graphviz" onclick="{! c.handleCopyGraphviz}" />
                <lightning:button label="Download Graphviz" onclick="{! c.handleDownloadGraphviz}" />
                <br /><br />
                <lightning:textarea aura:id="svgContentText" name="svgContent" value="{!v.svgContent}" label="SVG" readonly="true" class="downloadTextArea" />
                <lightning:button label="Copy SVG" onclick="{! c.handleCopySVG}" />
                <lightning:button label="Download SVG" onclick="{! c.handleDownloadSVG}" />

            </lightning:tab>

        </lightning:tabset>
    </c:Panel>

    <lightning:notificationsLibrary aura:id="notifLib"/>

</aura:component>